{"map":"{\"version\":3,\"sources\":[\"index.bundle.js\"],\"names\":[\"module\",\"exports\",\"modules\",\"installedModules\",\"__webpack_require__\",\"moduleId\",\"i\",\"l\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"require\",\"__webpack_exports__\",\"external_redis_\",\"external_redis_default\",\"external_fs_\",\"external_fs_default\",\"external_https_\",\"external_https_default\",\"external_joi_\",\"external_joi_default\",\"config\",\"envVarSchema\",\"a\",\"keys\",\"NODE_ENV\",\"string\",\"default\",\"allow\",\"PORT\",\"number\",\"MYSQL_PORT\",\"MYSQL_HOST\",\"MYSQL_USER\",\"MYSQL_PASS\",\"MYSQL_NAME\",\"VERSION\",\"unknown\",\"required\",\"error\",\"envVars\",\"validate\",\"process\",\"env\",\"Error\",\"message\",\"config_config\",\"version\",\"port\",\"mysqlPort\",\"mysqlHost\",\"mysqlUserName\",\"mysqlPass\",\"mysqlDatabase\",\"MYSQL_DATABASE\",\"external_express_\",\"external_express_default\",\"router\",\"Router\",\"req\",\"res\",\"render\",\"login_route\",\"register_route_router\",\"register_route\",\"external_jsonwebtoken_\",\"external_jsonwebtoken_default\",\"jwt_module\",\"token\",\"Promise\",\"resolve\",\"reject\",\"verify\",\"err\",\"payload\",\"console\",\"user_account\",\"sign\",\"_id\",\"toString\",\"expiresIn\",\"cookie\",\"maxAge\",\"httpOnly\",\"secure\",\"mainPage_controller\",\"cookies\",\"then\",\"jwtVerify_result\",\"catch\",\"send\",\"RoomID\",\"body\",\"mainPage_route_router\",\"post\",\"mainPage_route\",\"verification_route_router\",\"verification_route\",\"external_mysql_\",\"external_mysql_default\",\"connectionPool\",\"createPool\",\"connection\",\"host\",\"user\",\"password\",\"database\",\"message_module\",\"roomID\",\"fromUserID\",\"getConnection\",\"connectionError\",\"today\",\"Date\",\"date\",\"getFullYear\",\"getMonth\",\"getDate\",\"time\",\"getHours\",\"getMinutes\",\"getSeconds\",\"sqlCommand\",\"query\",\"result\",\"release\",\"roomName\",\"chatRoom_module_connectionPool\",\"chatRoom_module\",\"chatMessage_controller\",\"getRoomMember_result\",\"data\",\"getRoomID_result\",\"saveMessage_result\",\"client\",\"createClient\",\"on\",\"log\",\"LRANGE\",\"length\",\"jsonpackage\",\"messageName\",\"x\",\"JSON\",\"parse\",\"getChatPreloadMessage_result\",\"RPUSH\",\"stringify\",\"invite_module_connectionPool\",\"invite_module\",\"toUserID\",\"userID\",\"userData_module_connectionPool\",\"userData_module\",\"UserID\",\"UserAccount\",\"invite_controller\",\"getUserID_result\",\"getFriendInvite_result\",\"toUserID_result\",\"params\",\"userName\",\"fromUserID_result\",\"deleteFriendInvite_result\",\"postFriendInvite_result\",\"deleteGroupInvite_result\",\"userData_controller\",\"getUserRoom_result\",\"getFriend_result\",\"login_module_connectionPool\",\"login_module\",\"userAccount\",\"userPassword\",\"UserPassword\",\"login_controller\",\"checkAccount_result\",\"jwtSetCookie_result\",\"register_module_connectionPool\",\"register_module\",\"register_controller\",\"createAccount_result\",\"file_route_router\",\"delete\",\"getOldMessage_result\",\"file_route\",\"index_route_router\",\"use\",\"index_route\",\"external_body_parser_\",\"external_body_parser_default\",\"external_cors_\",\"external_cors_default\",\"external_morgan_\",\"external_morgan_default\",\"external_path_\",\"external_path_default\",\"external_cookie_parser_\",\"external_cookie_parser_default\",\"app\",\"json\",\"urlencoded\",\"extended\",\"set\",\"upload\",\"static\",\"join\",\"status\",\"express\",\"external_ws_\",\"external_ws_default\",\"clients\",\"SERVER_CONFIG\",\"readFileSync\",\"cert\",\"server\",\"createServer\",\"wss\",\"Server\",\"verifyClient\",\"info\",\"cb\",\"headers\",\"list\",\"split\",\"forEach\",\"parts\",\"shift\",\"trim\",\"decodeURI\",\"ws\",\"push\",\"jsonData\",\"account\",\"id\",\"fromUserAccount\",\"getMember_result\",\"jsonPackage\",\"some\",\"item\",\"index\",\"indexOf\",\"splice\",\"listen\"],\"mappings\":\"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\"}","code":"module.exports=function(e){var o={};function r(n){if(o[n])return o[n].exports;var s=o[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=o,r.d=function(e,o,n){r.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,o){if(1&o&&(e=r(e)),8&o)return e;if(4&o&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&o&&\"string\"!=typeof e)for(var s in e)r.d(n,s,function(o){return e[o]}.bind(null,s));return n},r.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(o,\"a\",o),o},r.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},r.p=\"\",r(r.s=14)}([function(e,o){e.exports=require(\"express\")},function(e,o){e.exports=require(\"mysql\")},function(e,o){e.exports=require(\"joi\")},function(e,o){e.exports=require(\"redis\")},function(e,o){e.exports=require(\"fs\")},function(e,o){e.exports=require(\"jsonwebtoken\")},function(e,o){e.exports=require(\"body-parser\")},function(e,o){e.exports=require(\"https\")},function(e,o){e.exports=require(\"cors\")},function(e,o){e.exports=require(\"morgan\")},function(e,o){e.exports=require(\"path\")},function(e,o){e.exports=require(\"cookie-parser\")},function(e,o){e.exports=require(\"ws\")},function(e,o){e.exports=require(\"dotenv\")},function(e,o,r){\"use strict\";r.r(o);var n=r(3),s=r.n(n),t=r(4),a=r.n(t),c=r(7),i=r.n(c),u=r(2),m=r.n(u);r(13).config();const l=m.a.object().keys({NODE_ENV:m.a.string().default(\"development\").allow([\"development\",\"production\"]),PORT:m.a.number().default(8080),MYSQL_PORT:m.a.number().default(3306),MYSQL_HOST:m.a.string().default(\"127.0.0.1\"),MYSQL_USER:m.a.string(),MYSQL_PASS:m.a.string(),MYSQL_NAME:m.a.string(),VERSION:m.a.string()}).unknown().required(),{error:d,value:f}=m.a.validate(process.env,l);if(d)throw new Error(\"Config validation error: \"+d.message);var g={version:f.VERSION,env:f.NODE_ENV,port:f.PORT,mysqlPort:f.MYSQL_PORT,mysqlHost:f.MYSQL_HOST,mysqlUserName:f.MYSQL_USER,mysqlPass:f.MYSQL_PASS,mysqlDatabase:f.MYSQL_DATABASE},h=r(0),v=r.n(h);const N=v.a.Router();N.get(\"/\",(e,o)=>{o.render(\"Login\")});var p=N;const I=v.a.Router();I.get(\"/\",(e,o)=>{o.render(\"Register\")});var y=I,S=r(5),R=r.n(S);var E=e=>new Promise((o,r)=>{R.a.verify(e,\"thisismynewproject\",(e,n)=>{e?(console.error(\"verify error:\",e),r(e)):o(n)})}),O=(e,o)=>new Promise((r,n)=>{const s=R.a.sign({_id:e.toString()},\"thisismynewproject\",{expiresIn:\"1 day\"});o.cookie(\"token\",s,{maxAge:1e6,httpOnly:!0,secure:!1}),r(\"CookieSet\")});var D=(e,o)=>{const r=e.cookies.token;E(r).then(e=>{o.render(\"RoomInput\")}).catch(e=>{o.send(e)})},U=(e,o)=>{const r=e.cookies.token;E(r).then(r=>{const n=e.body.RoomID;o.render(\"GroupChat\",{RoomID:n})}).catch(e=>{o.send(e)})};const q=v.a.Router();q.post(\"/\",(e,o)=>{U(e,o)}),q.get(\"/\",(e,o)=>{D(e,o)});var P=q;const w=v.a.Router();w.get(\"/\",(e,o)=>{o.render(\"Verification\")});var A=w,b=r(1),L=r.n(b);const M=L.a.createPool({connection:10,host:g.mysqlHost,user:g.mysqlUserName,password:g.mysqlPass,database:g.mysqlDatabase});var C=(e,o,r)=>new Promise((n,s)=>{M.getConnection((t,a)=>{if(t)s(t);else{var c=new Date,i=c.getFullYear()+\"-\"+(c.getMonth()+1)+\"-\"+c.getDate(),u=c.getHours()+\":\"+c.getMinutes()+\":\"+c.getSeconds(),m=\"INSERT INTO Message(RoomID, FromUserID, Time, Message) VALUES('\"+e+\"','\"+o+\"','\"+(i+\" \"+u)+\"','\"+r+\"')\";a.query(m,(function(e,o){e?(console.error(\"SQL error:\",e),s(e)):n(o)})),n(0),a.release()}})}),k=e=>new Promise((o,r)=>{M.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT account.UserAccount, Message.Message FROM chatroom INNER JOIN message ON chatroom.RoomID = message.RoomID INNER JOIN account ON account.UserID = message.FromUserID WHERE chatroom.RoomName = \"+e+\" ORDER BY message.MessageID limit 50\";s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n)})),s.release()}})});const x=L.a.createPool({connection:10,host:g.mysqlHost,user:g.mysqlUserName,password:g.mysqlPass,database:g.mysqlDatabase});var T=e=>new Promise((o,r)=>{x.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT RoomID FROM ChatRoom WHERE RoomName = '\"+e+\"'\";s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n[0])})),s.release()}})}),_=e=>new Promise((o,r)=>{x.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT member.UserID FROM chatroom INNER JOIN member ON chatroom.RoomID = member.RoomID WHERE chatroom.RoomName = '\"+e+\"'\";s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n)})),s.release()}})});var F=e=>new Promise((o,r)=>{_(e).then(e=>{o(e)}).catch(e=>{r(e)})}),J=e=>new Promise((o,r)=>{T(e.roomName).then(n=>{e.roomID=n.RoomID,C(e.roomID,e.fromUserID,e.message).then(e=>{o(e)}).catch(e=>{r(e)})}).catch(e=>{r(e)})}),Q=e=>new Promise((o,r)=>{const n=s.a.createClient();n.on(\"connect\",()=>{console.log(\"Redis client connected\")}),n.LRANGE(e+\"_message\",0,50,(s,t)=>{if(0!=t.length){var a={messageName:\"getOldMessage\"};for(let e=0;e<t.length;e++)t[e]=JSON.parse(t[e]);a.data=t,o(a)}else k(e).then(r=>{var s={messageName:\"getOldMessage\"};s.data=r;for(var t=0;t<s.data.length;t++)n.RPUSH(e+\"_message\",JSON.stringify(s.data[t]));o(s)}).catch(e=>{r(e)});if(s)throw console.log(s),s})});const H=L.a.createPool({connection:10,host:g.mysqlHost,user:g.mysqlUserName,password:g.mysqlPass,database:g.mysqlDatabase});var j=e=>new Promise((o,r)=>{H.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT Account.UserAccount FROM Account INNER JOIN friendInvite ON friendInvite.fromUserID = Account.userID WHERE friendInvite.toUserID =\"+e;s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n)})),s.release()}})}),Y=(e,o)=>new Promise((o,r)=>{H.getConnection((n,s)=>{if(n)r(n);else{var t=\"DELETE FROM friendInvite WHERE toUserID = \"+e+\" AND \";s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n)})),s.release()}})}),W=(e,o)=>new Promise((r,n)=>{H.getConnection((s,t)=>{if(s)n(s);else{var a=\"INSERT INTO friendInvite(toUserID, fromUserID) VALUES('\"+e+\"','\"+o+\"')\";t.query(a,(function(e,o){e?(console.error(\"SQL error:\",e),n(e)):r(o)})),t.release()}})}),V=e=>new Promise((o,r)=>{H.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT ChatRoom.RoomName FROM ChatRoom INNER JOIN groupInvite ON groupInvite.groupID = ChatRoom.RoomID WHERE groupInvite.userID =\"+e;s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n)})),s.release()}})});const $=L.a.createPool({connection:10,host:g.mysqlHost,user:g.mysqlUserName,password:g.mysqlPass,database:g.mysqlDatabase});var z=e=>new Promise((o,r)=>{$.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT chatroom.RoomID, chatroom.Time, member.UserID, chatroom.RoomName FROM member INNER JOIN chatroom ON chatroom.RoomID = member.RoomID WHERE member.UserID = \"+e;s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n)})),s.release()}})}),B=e=>new Promise((o,r)=>{$.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT Account.UserAccount FROM Account INNER JOIN Friend ON Friend.UserID2 = Account.UserID WHERE Friend.UserID1 = \"+e+\" UNION SELECT Account.UserAccount FROM Account INNER JOIN Friend ON Friend.UserID1 = Account.UserID WHERE Friend.UserID2 = \"+e;s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n)})),s.release()}})}),G=e=>new Promise((o,r)=>{$.getConnection((n,s)=>{if(n)r(n);else{var t=\"SELECT UserID FROM Account WHERE UserAccount = '\"+e+\"'\";s.query(t,(function(e,n){e?(console.error(\"SQL error:\",e),r(e)):o(n[0])})),s.release()}})});var K=(e,o)=>{const r=e.cookies.token;E(r).then(e=>{G(e._id).then(e=>{j(e.UserID).then(e=>{var r={messageName:\"friendInvite\"};r.data=e,o.send(JSON.stringify(r))}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})},X=(e,o)=>{const r=e.cookies.token;E(r).then(r=>{G(r._id).then(r=>{G(e.params.userName).then(e=>{Y(r.UserID,e.UserID).then(e=>{}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})},Z=(e,o)=>{const r=e.cookies.token;E(r).then(r=>{G(r._id).then(r=>{G(e.params.userName).then(e=>{W(e.UserID,r.UserID).then(e=>{}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})},ee=(e,o)=>{const r=e.cookies.token;E(r).then(e=>{G(e._id).then(e=>{V(e.UserID).then(e=>{var r={messageName:\"groupInvite\"};r.data=e,o.send(JSON.stringify(r))}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})};var oe=(e,o)=>{const r=e.cookies.token;E(r).then(e=>{G(e._id).then(e=>{z(e.UserID).then(e=>{var r={messageName:\"userRoom\"};r.data=e,o.send(JSON.stringify(r))}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})},re=(e,o)=>{const r=e.cookies.token;E(r).then(e=>{G(e._id).then(e=>{B(e.UserID).then(e=>{var r={messageName:\"userFriend\"};r.data=e,o.send(JSON.stringify(r))}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})}).catch(e=>{o.send(e)})},ne=(e,o)=>{const r=e.cookies.token;E(r).then(e=>{var r={messageName:\"userAccount\"};r.data=e._id,o.send(JSON.stringify(r))}).catch(e=>{o.send(e)})};const se=L.a.createPool({connection:10,host:g.mysqlHost,user:g.mysqlUserName,password:g.mysqlPass,database:g.mysqlDatabase});var te=(e,o)=>new Promise((r,n)=>{se.getConnection((s,t)=>{if(s)n(s);else{var a=\"Select UserPassword From account Where UserAccount = '\"+e+\"'\";t.query(a,(function(e,s){e?(console.error(\"SQL error:\",e),n(e)):0==s.length?r(\"Account not found\"):s[0].UserPassword===o?r(\"success\"):r(\"Password incorrect\")})),t.release()}})});var ae=(e,o)=>{te(e.params.userAccount,e.params.userPassword).then(r=>{if(\"success\"===r)O(e.params.userAccount,o).then(e=>{if(\"CookieSet\"===e){var r={result:\"success\"};o.send(JSON.stringify(r))}}).catch(e=>{o.send(e)});else{var n={result:\"fail\"};n.data=r,o.send(JSON.stringify(n))}}).catch(e=>{o.send(e)})};const ce=L.a.createPool({connection:10,host:g.mysqlHost,user:g.mysqlUserName,password:g.mysqlPass,database:g.mysqlDatabase});var ie=(e,o)=>new Promise((r,n)=>{ce.getConnection((s,t)=>{if(s)n(s);else{var a=\"INSERT INTO Account(UserAccount, UserPassword) VALUES('\"+e+\"','\"+o+\"')\";t.query(a,(function(e,o){e?(console.error(\"SQL error:\",e),n(e)):r(o)})),t.release()}})});var ue=(e,o)=>{te(e.params.userAccount,e.params.userPassword).then(r=>{if(console.log(r),\"Account not found\"===r)ie(e.params.userAccount,e.params.userPassword).then(e=>{var r={result:\"success\"};o.send(JSON.stringify(r))}).catch(e=>{o.send(e)});else if(\"success\"===r||\"Password incorrect\"===r){var n={result:\"fail\",data:\"Account exist\"};o.send(JSON.stringify(n))}console.log(\"sssss\")}).catch(e=>{o.send(e)})};const me=v.a.Router();me.get(\"/login/:userAccount/:userPassword\",(function(e,o){ae(e,o)})),me.post(\"/register/:userAccount/:userPassword\",(function(e,o){ue(e,o)})),me.get(\"/userName\",(function(e,o){ne(e,o)})),me.get(\"/room\",(function(e,o){oe(e,o)})),me.get(\"/friend\",(function(e,o){re(e,o)})),me.get(\"/groupInvite\",(function(e,o){ee(e,o)})),me.post(\"/groupInvite/:userName/:roomName\",(function(e,o){Z(e,o)})),me.delete(\"/groupInvite/:roomName\",(function(e,o){X(e,o)})),me.get(\"/friendInvite\",(function(e,o){K(e,o)})),me.post(\"/friendInvite/:userName\",(function(e,o){Z(e,o)})),me.delete(\"/friendInvite/:userName\",(function(e,o){X(e,o)})),me.get(\"/oldMessage/:roomName\",(function(e,o){Q(e.params.roomName).then(e=>{o.send(JSON.stringify(e))}).catch(e=>{console.log(e)})}));var le=me;const de=v.a.Router();de.use(\"/login\",p),de.use(\"/register\",y),de.use(\"/mainPage\",P),de.use(\"/verification\",A),de.use(\"/file\",le);var fe=de,ge=r(6),he=r.n(ge),ve=r(8),Ne=r.n(ve),pe=r(9),Ie=r.n(pe),ye=r(10),Se=r.n(ye),Re=r(11),Ee=r.n(Re);const Oe=v()();Oe.use(he.a.json()),Oe.use(he.a.urlencoded({extended:!0})),Oe.use(Ee()()),Oe.use(Ne()()),Oe.use(Ie()(\"dev\")),Oe.set(\"views\",\"./views\"),Oe.set(\"view engine\",\"jade\"),Oe.upload=function(e,o){console.log(e.body)},Oe.get(\"/\",(e,o)=>{o.send(`server started express on  port http://127.0.0.1:${g.port} (${g.env})`)}),Oe.use(\"/OnlineText\",fe),Oe.use(v.a.static(Se.a.join(\"D:/Front-endEngineerLearning/OnlineText/\",\"public\"))),Oe.use((function(e,o){o.status(404).render(\"404page\")}));var De=Oe,Ue=r(12),qe=r.n(Ue),Pe=[];const we={key:a.a.readFileSync(\"key.pem\"),cert:a.a.readFileSync(\"cert.pem\")},Ae=i.a.createServer(we,De),be=new qe.a.Server({server:Ae,verifyClient:function(e,o){var r=e.req.headers.cookie,n={};r?(r.split(\";\").forEach((function(e){var o=e.split(\"=\");n[o.shift().trim()]=decodeURI(o.join(\"=\"))})),E(n.token).then(e=>{o(!0)}).catch(e=>{console.log(e),o(!1,401,\"Unauthorized\")})):o(!1,401,\"Unauthorized\")}});be.on(\"connection\",e=>{Pe.push(e),e.on(\"message\",o=>{var r=JSON.parse(o);switch(r.messageName){case\"userAccount\":G(r.data).then(o=>{e.account=r.data,e.id=o.UserID}).catch(e=>{res.send(e)});break;case\"message\":r.data.fromUserID=e.id,r.data.fromUserAccount=e.account,J(r.data).then(e=>{F(r.data.roomName).then(e=>{const o=s.a.createClient();o.on(\"connect\",()=>{console.log(\"Redis client connected\")});let n={};n.UserAccount=r.data.fromUserAccount,n.Message=r.data.message,o.RPUSH(r.data.roomName+\"_message\",JSON.stringify(n));for(var t=0;t<Pe.length;t++)e.some(e=>e.UserID===Pe[t].id)&&Pe[t].send(JSON.stringify(r))}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)})}}),e.on(\"close\",()=>{console.log(\"Close connected\");const o=Pe.indexOf(e);o>-1&&Pe.splice(o,1)})}),Ae.listen(g.port,()=>{console.log(`server started on port https://127.0.\\n    0.1:${g.port} (${g.env})`)});o.default={app:De,wss:be}}]);","extractedComments":[]}