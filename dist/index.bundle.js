module.exports=function(e){var r={};function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)t.d(o,n,function(r){return e[r]}.bind(null,n));return o},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=13)}([function(e,r,t){"use strict";var o=t(2),n=t.n(o);t(14).config();const s=n.a.object().keys({NODE_ENV:n.a.string().default("development").allow(["development","production"]),PORT:n.a.number().default(8080),MYSQL_PORT:n.a.number().default(3306),MYSQL_HOST:n.a.string().default("127.0.0.1"),MYSQL_USER:n.a.string(),MYSQL_PASS:n.a.string(),MYSQL_NAME:n.a.string(),VERSION:n.a.string()}).unknown().required(),{error:a,value:i}=n.a.validate(process.env,s);if(a)throw new Error("Config validation error: "+a.message);const c={version:i.VERSION,env:i.NODE_ENV,port:i.PORT,mysqlPort:i.MYSQL_PORT,mysqlHost:i.MYSQL_HOST,mysqlUserName:i.MYSQL_USER,mysqlPass:i.MYSQL_PASS,mysqlDatabase:i.MYSQL_DATABASE};r.a=c},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("joi")},function(e,r){e.exports=require("mysql")},function(e,r,t){"use strict";(function(e){var o=t(1),n=t.n(o),s=t(0),a=t(12),i=t(6),c=t.n(i),u=t(8),l=t.n(u),d=t(9),p=t.n(d),f=t(7),m=t.n(f),g=t(10),v=t.n(g);const y=n()();y.use(c.a.json()),y.use(c.a.urlencoded({extended:!0})),y.use(v()()),y.use(l()()),y.use(p()("dev")),y.set("views","./views"),y.set("view engine","jade"),y.upload=function(e,r){console.log(e.body)},y.get("/",(e,r)=>{r.send(`server started express on  port http://127.0.0.1:${s.a.port} (${s.a.env})`)}),y.use("/OnlineText",a.a),y.use(n.a.static(m.a.join(m.a.join(e,"OnlineText"),"public"))),y.use((function(e,r){r.status(404).render("404page")})),r.a=y}).call(this,"/")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("morgan")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("ws")},function(e,r,t){"use strict";var o=t(1),n=t.n(o),s=t(3),a=t.n(s),i=t(0);const c=a.a.createPool({connection:10,host:i.a.mysqlHost,user:i.a.mysqlUserName,password:i.a.mysqlPass,database:i.a.mysqlDatabase});var u=e=>new Promise((r,t)=>{c.getConnection((o,n)=>{o?t(o):(n.query("Select user_password From account Where user_account = ?",e.user_account,(o,n)=>{o?(console.error("SQL error:",o),t(o)):n[0].user_password===e.user_password?r("success login"):r("fail login")}),n.release())})}),l=t(5),d=t.n(l);var p=e=>new Promise((r,t)=>{d.a.verify(e,"thisismynewproject",(e,t)=>{r(e?"Unverify":"Verify")})}),f=(e,r)=>new Promise((t,o)=>{const n=d.a.sign({_id:e.toString()},"thisismynewproject",{expiresIn:"1 day"});r.cookie("token",n,{maxAge:1e6,httpOnly:!0,secure:!1}),t("CookieSet")});var m=(e,r)=>{const t=e.body;u(t).then(e=>{"success login"===e?(f(t.user_account,r).then(e=>{}).catch(e=>{r.send(e)}),r.redirect("mainPage")):"fail login"===e&&r.render("Login",{success:!1})}).catch(e=>{r.send(e)})};const g=n.a.Router();g.post("/",(e,r)=>{m(e,r)}),g.get("/",(e,r)=>{r.render("Login")});var v=g;const y=a.a.createPool({connection:10,host:i.a.mysqlHost,user:i.a.mysqlUserName,password:i.a.mysqlPass,database:i.a.mysqlDatabase});var S=e=>new Promise((r,t)=>{y.getConnection((o,n)=>{o?t(o):(n.query("insert INTO Account SET ?",{user_account:e.user_account,user_password:e.user_password},(e,o)=>{e?(console.error("SQL error:",e),t(e)):r("success register")}),n.release())})});var q=(e,r)=>{const t=e.body;S(t).then(e=>{"success register"===e&&r.redirect("verification")}).catch(e=>{r.send(e)})};const b=n.a.Router();b.post("/",(e,r)=>{q(e,r)}),b.get("/",(e,r)=>{r.render("Register")});var _=b;var h=(e,r)=>{const t=e.cookies.token;p(t).then(e=>{"Verify"===e?r.render("RoomInput"):r.redirect("login")}).catch(e=>{r.send(e)})},w=(e,r)=>{const t=e.cookies.token;p(t).then(t=>{if("Verify"===t){const t=e.body.RoomID;r.render("ChatTest",{RoomID:t})}else r.redirect("login")}).catch(e=>{r.send(e)})};const x=n.a.Router();x.post("/",(e,r)=>{w(e,r)}),x.get("/",(e,r)=>{h(e,r)});var P=x;const R=n.a.Router();R.get("/",(e,r)=>{r.render("Verification")});var O=R;a.a.createPool({connection:10,host:i.a.mysqlHost,user:i.a.mysqlUserName,password:i.a.mysqlPass,database:i.a.mysqlDatabase});var j=(e,r)=>{r.send(JSON.stringify({data:{message:[{data:"1",RoomID:123},{data:"2",RoomID:123},{data:"3",RoomID:123},{data:"4",RoomID:123},{data:"5",RoomID:123}]},messageLength:5}))};const M=n.a.Router();M.get("/chatMessage/:chatRoom",(function(e,r){j(e,r)}));var L=M;const D=n.a.Router();D.use("/login",v),D.use("/register",_),D.use("/mainPage",P),D.use("/verification",O),D.use("/file",L);r.a=D},function(e,r,t){"use strict";t.r(r);var o=t(0),n=t(4),s=t(11),a=t.n(s);const i=t(15).createServer(n.a),c=new a.a.Server({server:i});c.on("connection",e=>{console.log("Client connected"),e.on("message",r=>{e.send(r)}),e.on("close",()=>{console.log("Close connected")})}),i.listen(o.a.port,()=>{console.log(`server started on port http://127.0.\n    0.1:${o.a.port} (${o.a.env})`)}),r.default={app:n.a,wss:c}},function(e,r){e.exports=require("dotenv")},function(e,r){e.exports=require("http")}]);
//# sourceMappingURL=index.bundle.js.map